<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 목록</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<!-- 검색 입력창과 버튼 -->
    <form method="GET" action="/search_project">
        <input type="text" name="query" placeholder="프로젝트 검색">
        <input type="submit" value="검색">
    </form>

    <h2>프로젝트 목록</h2>
    <ul>
    {% for project in projects %}
        <li>
            <h3>{{ project[1] }}</h3>
            <p>설명: {{ project[2] }}</p>
            <p>모집 여부: {{ project[4] }}</p>
            <p>모집 인원: {{ project[5] }}</p>
            <p>생성일: {{ project[7] }}</p>
            {% if project[6] %}
                <img src="{{ url_for('static', filename=project[6]) }}" alt="프로젝트 이미지" width="200">
            {% endif %}
        </li>
    {% endfor %}
    </ul>

    <script>
    $(document).ready(function() {
    // 페이지 로드시 projects_list를 통해 모든 프로젝트 데이터를 불러와서 보여줍니다.
        $.ajax({
            url: "{{ url_for('projects_list') }}",
            type: "GET",
            success: function(projects) {
                console.log(projects);
                var projects = response.projects;
                var projectList = $("#project-list");
                projectList.empty();

                projects.forEach(function(project) {
                    var imagePath = project[6] ? '/static/' + project[6] : '';
                    var listItem = `
                    <li>
                        <h3>${project[1]}</h3>
                        <p>설명: ${project[2]}</p>
                        <p>모집 여부: ${project[4]}</p>
                        <p>모집 인원: ${project[5]}</p>
                        <p>생성일: ${project[7]}</p>
                        ${project[6] ? '<img src="' + imagePath + '" alt="프로젝트 이미지" width="200">' : ''}
                    </li>`;
                    projectList.append(listItem);
                });
            },
            error: function(error) {
                console.log("Error:", error);
            }
        });

        // 검색 버튼 클릭 시 search_project를 통해 데이터를 검색해서 보여줍니다.
        $("#search-button").on("click", function() {
            var query = $("#search-input").val();
            $.getJSON("/search_project", { "query": query }, function(data) {
                var projects = data.projects;
                var projectList = $("#project-list");
                projectList.empty();

                projects.forEach(function(project) {
                    var imagePath = project[6] ? '/static/' + project[6] : '';
                    var listItem = `
                    <li>
                        <h3>${project[1]}</h3>
                        <p>설명: ${project[2]}</p>
                        <p>모집 여부: ${project[4]}</p>
                        <p>모집 인원: ${project[5]}</p>
                        <p>생성일: ${project[7]}</p>
                        ${project[6] ? '<img src="' + imagePath + '" alt="프로젝트 이미지" width="200">' : ''}
                    </li>`;
                    projectList.append(listItem);
                });
            }).fail(function() {
                console.error("Error occurred during fetching the data.");
            });
        });
    });
    </script>
    {{projectList}}
</body>
</html>
